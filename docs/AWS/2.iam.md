# IAM

IAM stands for Identity and Access Management and is a global service. in IAM we're going to create our users and assign them to groups and give them permissions to do certain things.

**Summary:**

- IAM = Identity and Access Management, Global Service.
- When we create an AWS account, a root account is created by default. This account has full admin access to everything in our account. We should never use this account for security reasons..
- Users are people within your organization, and can be grouped; Users are mapped to a physical user, has a password for AWS Console.
- Groups only contain users, not other groups, can't be nested.
- Users don't have to belong to a group, and a user can belong to multiple groups.
- Policies ⇒ JSON document that outlines permissions for users or groups
- Roles ⇒ for EC2 instances or AWS services
- Security ⇒ MFA + Password Policy
- Access Keys provide programmatic access to the AWS API, CLI, SDK, and other development tools.
- Audit ⇒ IAM Credential Reports & IAM Access Advisor

![users-groups.png](../images/aws/iam/users-groups.png)

## IAM Permissions

Users or Groups can be assigned JSON documents called polices.

Example:

```json title="policy.json"
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Stmt1234567890",
      "Effect": "Allow",
      "Action": ["s3:ListAllMyBuckets", "s3:GetBucketLocation"],
      "Resource": ["arn:aws:s3:::*"]
    },
    {
      "Sid": "Stmt1234567891",
      "Effect": "Allow",
      "Action": ["ec2:Describe*"],
      "Resource": ["*"]
    },
    {
      "Sid": "Stmt1234567892",
      "Effect": "Allow",
      "Action": [
        "cloudwatch:ListMetrics",
        "cloudwatch:GetMetricStatistics",
        "cloudwatch:Describe*"
      ],
      "Resource": ["*"]
    }
  ]
}
```

In the policy you define what a user or group is allowed to do in AWS.

It's recommended to apply the **least privilege principle**, which means that you should only give the minimum permissions required to do the job.

### Add User

IAM ⇒ Users tab ⇒ Add Users:

- Select a name
- credential type ⇒ password ⇒ custom password
- Require password reset ⇒ doesn't need
- next
- **Add user to group**
- create a group
- choose a name and the policies
- tags ⇒ information's, ex: Department ⇒ engineer
- now we can create the user and download the csv

**Login With IAM**

go to IAM ⇒ Dashboard

in the right bar we have 'Sign-in URL for IAM users in this account' url

we can copy and open in a anonymous tab and set our IAM username and password that we just created.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/88820901-a10a-45ff-bc32-483a6d4b84ff/Untitled.png)

## Polices inheritance

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ee7e5753-4955-4652-88f1-cde063f7fe88/Untitled.png)

Consists of:

- **Version:** policy language version, always include "2012-10-17"
- **Id:** an identifier for the policy (optional)
- **Statement:** one or more individual statements (required)
- Statements consists of
  - **Sid:** and identifier for the statement (optional)
  - **Effect:** whether the statement allows or denies access (Allow/Deny)
  - **Principal:** account/user/role to which this policy applied to
  - **Action:** list of actions this policy allows or denies based on effect
  - **Resource:** list of resources to which the actions applied to
  - **Condition:** conditions for when this policy is in effect (optional)

## Password

IAM ⇒ Account settings ⇒ change password policy

We can customize this settings to improve the security of our accounts

---

## CLI

To access AWS we have three options

- AWS Management console ⇒ (Protected by password + MFA)
- AWS Command Line Interface (CLI) ⇒ Protected by access key
- AWS Software Developer Kit (SDK) ⇒ Protected by access keys

Access keys are generated through the AWS console

Users manage their own access key

AWS Cli is a tool that enables you to interact with AWS services using commands in your command line shell

Direct access to the public APIs of AWS services

Install:

https://docs.aws.amazon.com/cli/latest/userguide/getting-started-version.html

**Generete access key**

Obs. we should never create access key for our root account for security reasons

IAM ⇒ Users ⇒ Choose a user ⇒ Security credentials

And in this tab we can create a access key

in the terminal:

```powershell
aws configure
```

now we can set the

- access key id;
- secret key
- region: ex: us-east-1
- Default output format we can let blank

```powershell
aws iam list-users
```

## IAM Roles for services

Some aws services will need to perform actions on your behalf

To do so, we will assign permissions to AWS service with IAM Roles

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f6d7f7dd-e249-4217-b84c-41d2e8bc4614/Untitled.png)

hands on:

IAM ⇒ Roles ⇒ Create Role

We can choose the role to which service we want, ex: EC2

⇒ Next

And now we can give the permissions to which services the EC2 will have access to.

Ex: IAMReadOnlyAccess

⇒ Next ⇒ Choose a Name and create

## IAM Best Practices

- Don't use the root account expect for AWS account setup
- One physical user = One AWS user
- Assign users to groups and assign permissions to groups
- Create a strong password policy
- Use and enforce the use of Multi Factor Authentication (MFA)
- Create and use Roles for giving permissions to AWS services
- Audit permission of your account with the IAM Credentials Report
